- name: pacman -Syu
  community.general.pacman:
    update_cache: yes
    upgrade: true

- name: install basic utils, shells, apps
  community.general.pacman:
    name:
      - archlinux-keyring
      - acpi
      - bind
      - cronie
      - inetutils
      - strace
      - sysstat
      - jgmenu
      - base-devel
      - htop
      - kitty
      - libva
      - libva-intel-driver
      - libva-utils
      - network-manager-applet
      - networkmanager
      - networkmanager-openvpn
      - openssh
      - picom
      - parted
      - python-setuptools
      - powertop
      - source-highlight
      - tint2
      - tree
      - tlp
      - vi
      - wpa_supplicant
      - xfce4-power-manager
      - xorg-xinput
      - xorg-xwininfo
      - xorg-xdpyinfo
      - x11-ssh-askpass
      - man-db
    state: present

- name: Install archival utils
  pacman:
    name:
      - p7zip
      - unrar
      - unzip
      - xz
      - zip
      - bzip2
      - gzip
      - tar
    state: present

- name: Install download utils
  pacman:
    name:
      - curl
      - wget
      - flatpak
      - python-pip
    state: present

- name: Disable PulseAudio user services (if present)
  become: false
  systemd:
    name: "{{ item }}"
    scope: user
    enabled: no
    state: stopped
  loop:
    - pulseaudio.service
    - pulseaudio.socket
  ignore_errors: true

- name: Install extra packages
  pacman:
    name:
      - arch-audit-gtk
      - bashtop
      - bat
      - blueman
      - bluez
      - bluez-utils
      - conky
      - docker
      - docker-compose
      - evince
      - fcitx5
      - fcitx5-configtool
      - fcitx5-gtk
      - fcitx5-mozc
      - fcitx5-qt
      - gimp
      - git
      - go
      - gsimplecal
      - jq
      - lshw
      - mpv
      - noto-fonts
      - noto-fonts-cjk
      - noto-fonts-emoji
      - ttf-nerd-fonts-symbols
      - ttf-nerd-fonts-symbols-common
      - ttf-font-awesome
      - nvidia
      - nvidia-settings
      - nvidia-utils
      - pamixer
      - pavucontrol
      - playerctl
      # --- PipeWire stack (PulseAudio replacement) ---
      - pipewire
      - pipewire-audio
      - pipewire-pulse
      - wireplumber
      - pipewire-alsa
      - pipewire-jack
      # ---------------------------------------------
      - redshift
      - rofi
      - slock
      - stow
      - vlc
      - whois
      - wireguard-tools
      - xf86-video-nouveau
      - gvim
      - python-pynvim
    state: present

- name: Remove pulseaudio packages (migrate to pipewire)
  pacman:
    name:
      - pulseaudio
      - pulseaudio-bluetooth
    state: absent
  become: yes

#due to `Ã— This environment is externally managed` error, fixed to use pacman for installing packages."
#- name: Install python packages
#  pip:
#    name:
#      - pynvim
#    state: present

- name: enable sshd
  systemd:
    name: sshd.service
    state: started
    daemon_reload: yes
    enabled: yes
  become: yes

- name: enable docker
  systemd:
    name: docker.service
    daemon_reload: yes
    enabled: yes
  become: yes

- name: Enable PipeWire user services
  systemd:
    name: "{{ item }}"
    scope: user
    enabled: yes
    state: started
  loop:
    - pipewire.service
    - pipewire-pulse.service
    - wireplumber.service
  become: no
